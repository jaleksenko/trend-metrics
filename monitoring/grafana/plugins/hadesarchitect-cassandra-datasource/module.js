define(["@grafana/data","lodash","@grafana/runtime","react","@grafana/ui"],((e,t,n,a,r)=>(()=>{"use strict";var o={305:t=>{t.exports=e},545:e=>{e.exports=n},388:e=>{e.exports=r},980:e=>{e.exports=t},650:e=>{e.exports=a}},l={};function s(e){var t=l[e];if(void 0!==t)return t.exports;var n=l[e]={exports:{}};return o[e](n,n.exports,s),n.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{s.r(i),s.d(i,{plugin:()=>I});var e=s(305),t=s(980),n=s.n(t),a=s(545);function r(e,t,n,a,r,o,l){try{var s=e[o](l),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(a,r)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var l=e.apply(t,n);function s(e){r(l,a,o,s,i,"next",e)}function i(e){r(l,a,o,s,i,"throw",e)}s(void 0)}))}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class u extends a.DataSourceWithBackend{query(e){if(this.isEditorMode(e)){if(!this.isEditorCompleted(e))throw new Error("Skipping query execution while not all editor fields are filled")}else if(!this.isConfiguratorCompleted(e))throw new Error("Skipping query execution while not all configurator fields are filled");return super.query(this.buildQueryParameters(e))}metricFindQuery(e,t){var n=this;return o((function*(){return yield n.getResource("variables",{query:e.query})}))()}isEditorMode(e){return!e.targets[0].rawQuery}isEditorCompleted(e){return Boolean(e.targets[0].keyspace&&e.targets[0].table&&e.targets[0].columnTime&&e.targets[0].columnValue&&e.targets[0].columnId&&e.targets[0].valueId)}isConfiguratorCompleted(e){return Boolean(e.targets[0].target)}getKeyspaces(){var e=this;return o((function*(){return e.getResource("keyspaces")}))()}getTables(e){var t=this;return o((function*(){return t.getResource("tables",{keyspace:e})}))()}getColumns(e,t,n){var a=this;return o((function*(){return a.getResource("columns",{keyspace:e,table:t,needType:n})}))()}buildQueryParameters(e){e.targets=n().filter(e.targets,(e=>"select metric"!==e.target));const t=n().map(e.targets,(t=>({datasourceId:t.datasourceId,queryType:t.queryType,target:(0,a.getTemplateSrv)().replace(t.target,e.scopedVars,"csv"),refId:t.refId,hide:t.hide,rawQuery:t.rawQuery,filtering:t.filtering,keyspace:t.keyspace,table:t.table,columnTime:t.columnTime,columnValue:t.columnValue,columnId:t.columnId,valueId:(0,a.getTemplateSrv)().replace(t.valueId,e.scopedVars,"csv"),alias:t.alias,instant:t.instant})));return e.targets=t,e}constructor(e){super(e),l(this,"headers",void 0),l(this,"id",void 0),this.headers={"Content-Type":"application/json"},this.id=e.id,this.annotations={}}}var c=s(650),p=s.n(c),h=s(388);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){d(e,t,n[t])}))}return e}function y(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function g(e){return e?{label:e,value:e}:{}}class b extends c.PureComponent{onRunQuery(t){this.props.query.queryType="query",this.props.app&&this.props.app===e.CoreApp.UnifiedAlerting&&(this.props.query.queryType="alert");const{onChange:n,query:a}=this.props;n(y(m({},a),{queryType:t.query.queryType})),(t.query.keyspace&&""!==t.query.keyspace&&t.query.table&&""!==t.query.table&&t.query.columnTime&&""!==t.query.columnTime&&t.query.columnValue&&""!==t.query.columnValue&&t.query.columnId&&""!==t.query.columnId&&t.query.valueId&&""!==t.query.valueId||t.query.target&&""!==t.query.target)&&this.props.onRunQuery()}getKeyspaces(){const e=[];return this.props.datasource.getKeyspaces().then((t=>{t.forEach((t=>{e.push({label:t,value:t})}))})),e}getTables(){if(!this.props.query.keyspace)return[];const e=[];return this.props.datasource.getTables(this.props.query.keyspace).then((t=>{t.forEach((t=>{e.push({label:t,value:t})}))})),e}getOptions(e){if(!this.props.query.keyspace||!this.props.query.table)return[];const t=[];return this.props.datasource.getColumns(this.props.query.keyspace,this.props.query.table,e).then((e=>{e.forEach((e=>{t.push({label:e,value:e})}))})),t}render(){const e=this.props;return p().createElement("div",null,e.query.rawQuery&&p().createElement(p().Fragment,null,p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Cassandra CQL Query",labelWidth:30,tooltip:"Enter Cassandra CQL query. There are $__timeFrom/$__timeTo, $__unixEpochFrom/$__unixEpochTo and $__from/$__to variables to dynamically limit time range in queries. You should always use them to avoid excessive data fetching from DB.",grow:!0},p().createElement(h.TextArea,{placeholder:"Enter a CQL query",onChange:this.onQueryTextChange,onBlur:()=>{this.onRunQuery(this.props)},value:this.props.query.target})),p().createElement(h.Button,{icon:"pen",variant:"secondary","aria-label":"Toggle editor mode",onClick:this.onChangeQueryType})),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Alias",labelWidth:30,tooltip:"Series name override. Plain text or template using column names, e.g. `{{ column1 }}:{{ column2}}`"},p().createElement(h.Input,{name:"alias",onChange:this.onAliasChange,onBlur:()=>{this.onRunQuery(this.props)},value:this.props.query.alias||""})))),!e.query.rawQuery&&p().createElement(p().Fragment,null,p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Keyspace",labelWidth:30,tooltip:"Specify keyspace to work with"},p().createElement(h.Select,{allowCustomValue:!0,value:g(this.props.query.keyspace),placeholder:"keyspace name",onChange:this.onKeyspaceChange,options:this.getKeyspaces(),onBlur:()=>{this.onRunQuery(this.props)},width:90})),p().createElement(h.Button,{icon:"pen",variant:"secondary","aria-label":"Toggle editor mode",onClick:this.onChangeQueryType})),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Table",labelWidth:30,tooltip:"Specify table to work with"},p().createElement(h.Select,{allowCustomValue:!0,value:g(this.props.query.table),placeholder:"table name",onChange:this.onTableChange,options:this.getTables(),onBlur:()=>{this.onRunQuery(this.props)},width:90}))),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Time Column",labelWidth:30,tooltip:"Specify name of a timestamp column to identify time (created_at, time etc.)"},p().createElement(h.Select,{allowCustomValue:!0,value:g(this.props.query.columnTime),placeholder:"time column",onChange:this.onTimeColumnChange,onBlur:()=>{this.onRunQuery(this.props)},options:this.getOptions("timestamp"),width:90}))),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Value Column",labelWidth:30,tooltip:"Specify name of a numeric column to retrieve value (temperature, price etc.)"},p().createElement(h.Select,{allowCustomValue:!0,placeholder:"value column",value:g(this.props.query.columnValue),options:this.getOptions("int"),onChange:this.onValueColumnChange,onBlur:()=>{this.onRunQuery(this.props)},width:90}))),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"ID Column",labelWidth:30,tooltip:"Specify name of a ID column to identify the row (id, sensor_id etc.)"},p().createElement(h.Select,{allowCustomValue:!0,placeholder:"ID column",value:g(this.props.query.columnId),onChange:this.onIDColumnChange,onBlur:()=>{this.onRunQuery(this.props)},options:this.getOptions("uuid"),width:90}))),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"ID Value",labelWidth:30,tooltip:"Specify UUID value of a column to identify the row (f.e. 123e4567-e89b-12d3-a456-426655440000)"},p().createElement(h.Input,{name:"value_column",placeholder:"123e4567-e89b-12d3-a456-426655440000",value:this.props.query.valueId||"",onChange:this.onIDValueChange,onBlur:()=>{this.onRunQuery(this.props)},width:90,required:!0}))),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Alias",labelWidth:30,tooltip:"Series name override. Plain text or template using column names, e.g. `{{ column1 }}:{{ column2}}`"},p().createElement(h.Input,{name:"alias",placeholder:"my alias",value:this.props.query.alias||"",onChange:this.onAliasChange,onBlur:()=>{this.onRunQuery(this.props)},width:90}))),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Instant",labelWidth:30,tooltip:"Queries only first point for each series(PER PARTITION LIMIT 1)"},p().createElement(h.InlineSwitch,{value:this.props.query.instant,onChange:this.onInstantChange,onBlur:()=>{this.onRunQuery(this.props)}}))),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Allow filtering",labelWidth:30,tooltip:"Allow Filtering can be dangerous practice and we strongly discourage using it"},p().createElement(h.InlineSwitch,{value:this.props.query.filtering,onChange:this.onFilteringChange,onBlur:()=>{this.onRunQuery(this.props)}})))))}constructor(e){super(e),d(this,"onChangeQueryType",(()=>{const{onChange:e,query:t}=this.props;e(y(m({},t),{rawQuery:!t.rawQuery}))})),d(this,"onQueryTextChange",(e=>{const{onChange:t,query:n}=this.props,{value:a}=e.target;t(y(m({},n),{target:a}))})),d(this,"onKeyspaceChange",(e=>{const{onChange:t,query:n}=this.props;t(y(m({},n),{keyspace:e.value}))})),d(this,"onTableChange",(e=>{const{onChange:t,query:n}=this.props;t(y(m({},n),{table:e.value}))})),d(this,"onTimeColumnChange",(e=>{const{onChange:t,query:n}=this.props;t(y(m({},n),{columnTime:e.value}))})),d(this,"onValueColumnChange",(e=>{const{onChange:t,query:n}=this.props;t(y(m({},n),{columnValue:e.value}))})),d(this,"onIDColumnChange",(e=>{const{onChange:t,query:n}=this.props;t(y(m({},n),{columnId:e.value}))})),d(this,"onIDValueChange",(e=>{const{onChange:t,query:n}=this.props;t(y(m({},n),{valueId:e.target.value}))})),d(this,"onAliasChange",(e=>{const{onChange:t,query:n}=this.props;t(y(m({},n),{alias:e.target.value}))})),d(this,"onFilteringChange",(e=>{const{onChange:t,query:n}=this.props;t(y(m({},n),{filtering:e.target.checked}))})),d(this,"onInstantChange",(e=>{const{onChange:t,query:n}=this.props;t(y(m({},n),{instant:e.target.checked}))}));const{onChange:t,query:n}=this.props;t(y(m({},n),{datasourceId:e.datasource.id}))}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){C(e,t,n[t])}))}return e}function w(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const{SecretFormField:E}=h.LegacyForms;class O extends c.PureComponent{render(){var e;const{onOptionsChange:t,options:n}=this.props,{jsonData:a}=n,r=[{label:"ONE",value:"ONE"},{label:"TWO",value:"TWO"},{label:"THREE",value:"THREE"},{label:"QUORUM",value:"QUORUM"},{label:"ALL",value:"ALL"},{label:"LOCAL_QUORUM",value:"LOCAL_QUORUM"},{label:"EACH_QUORUM",value:"EACH_QUORUM"},{label:"LOCAL_ONE",value:"LOCAL_ONE"}];return this.props.options.jsonData.consistency&&""!==this.props.options.jsonData.consistency||(this.props.options.jsonData.consistency=r[0].value),p().createElement(p().Fragment,null,p().createElement(h.FieldSet,{label:"Connection settings"},p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Host",labelWidth:20,tooltip:"Specify host and port like `192.168.12.134:9042`. You can specify multiple contact points using semicolon, f.e. `host1:9042;host2:9042;host3:9042`"},p().createElement(h.Input,{name:"host",value:n.url||"",placeholder:"cassandra:9042",invalid:""===n.url,onChange:this.onHostChange,width:60}))),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Keyspace",labelWidth:20},p().createElement(h.Input,{name:"keyspace",value:n.jsonData.keyspace,placeholder:"keyspace name",onChange:this.onKeyspaceChange,width:60}))),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Consistency",labelWidth:20},p().createElement(h.Select,{placeholder:"choose consistensy",options:r,isClearable:!1,isSearchable:!0,value:n.jsonData.consistency||r[0],onChange:e=>{a.consistency=e.value,t(w(v({},n),{jsonData:a}))},width:60}))),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Credentials",tooltip:"We strongly recommend to create a custom Cassandra user for Grafana with strictly read-only permissions!",labelWidth:20},p().createElement(h.Input,{name:"user",placeholder:"user",value:n.jsonData.user,invalid:""===n.jsonData.user,onChange:this.onUserChange,width:25})),p().createElement(h.InlineField,null,p().createElement(E,{isConfigured:!1,value:(null===(e=n.secureJsonData)||void 0===e?void 0:e.password)||"",onReset:this.onPasswordReset,onChange:this.onPasswordChange,labelWidth:5}))),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Timeout",labelWidth:20,tooltip:"Timeout in seconds. Keep empty for the default value"},p().createElement(h.Input,{name:"timeout",placeholder:"",type:"number",step:1,value:n.jsonData.timeout,onChange:this.onTimeoutChange,width:60})))),p().createElement(h.FieldSet,{label:"TLS Settings"},p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Custom TLS settings",tooltip:"Enable if you need custom TLS configuration (usually required using AstraDB, AWS Keyspaces etc.)",labelWidth:30},p().createElement(h.InlineSwitch,{value:n.jsonData.useCustomTLS,onChange:this.onUseCustomTLSChange}))),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Allow self-signed certificates",labelWidth:30,tooltip:"Enable `custom TLS settings` to allow self-signed certificates",disabled:!n.jsonData.useCustomTLS},p().createElement(h.InlineSwitch,{value:n.jsonData.allowInsecureTLS,onChange:e=>{const a=w(v({},n.jsonData),{allowInsecureTLS:e.currentTarget.checked});t(w(v({},n),{jsonData:a}))}}))),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Certificate Path",labelWidth:30,disabled:!n.jsonData.useCustomTLS,tooltip:"Enable `custom TLS settings` to configure certificates"},p().createElement(h.Input,{value:n.jsonData.certPath,placeholder:"certificate path",onChange:e=>{const a=w(v({},n.jsonData),{certPath:e.currentTarget.value});t(w(v({},n),{jsonData:a}))},width:60}))),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"Root Certificate Path",labelWidth:30,disabled:!n.jsonData.useCustomTLS,tooltip:"Enable `custom TLS settings` to configure certificates"},p().createElement(h.Input,{value:n.jsonData.rootPath,placeholder:"root certificate path",onChange:e=>{const a=w(v({},n.jsonData),{rootPath:e.currentTarget.value});t(w(v({},n),{jsonData:a}))},width:60}))),p().createElement(h.InlineFieldRow,null,p().createElement(h.InlineField,{label:"RootCA Certificate Path",labelWidth:30,disabled:!n.jsonData.useCustomTLS,tooltip:"Enable `custom TLS settings` to configure certificates"},p().createElement(h.Input,{value:n.jsonData.caPath,placeholder:"CA certificate path",onChange:e=>{const a=w(v({},n.jsonData),{caPath:e.currentTarget.value});t(w(v({},n),{jsonData:a}))},width:60})))))}constructor(...e){super(...e),C(this,"onHostChange",(e=>{""===e.target.value?(e.target.setCustomValidity("Cannot be empty"),e.target.placeholder="This field cannot be empty!",e.target.style.setProperty("border-color","red")):(e.target.setCustomValidity(""),e.target.placeholder="cassandra:9042",e.target.style.setProperty("border-color",""));const{onOptionsChange:t,options:n}=this.props,a=e.target.value;t(w(v({},n),{url:a}))})),C(this,"onKeyspaceChange",(e=>{const{onOptionsChange:t,options:n}=this.props,a=w(v({},n.jsonData),{keyspace:e.target.value});t(w(v({},n),{jsonData:a}))})),C(this,"onAPIKeyChange",(e=>{const{onOptionsChange:t,options:n}=this.props;t(w(v({},n),{secureJsonData:{apiKey:e.target.value}}))})),C(this,"onUserChange",(e=>{const{onOptionsChange:t,options:n}=this.props,a=w(v({},n.jsonData),{user:e.target.value});t(w(v({},n),{jsonData:a}))})),C(this,"onTimeoutChange",(e=>{const{onOptionsChange:t,options:n}=this.props,a=w(v({},n.jsonData),{timeout:Number(e.target.value)});t(w(v({},n),{jsonData:a}))})),C(this,"onUseCustomTLSChange",(e=>{const{onOptionsChange:t,options:n}=this.props,a=w(v({},n.jsonData),{useCustomTLS:e.currentTarget.checked});t(w(v({},n),{jsonData:a}))})),C(this,"onPasswordReset",(()=>{const{onOptionsChange:e,options:t}=this.props;e(w(v({},t),{secureJsonFields:w(v({},t.secureJsonFields),{password:!1}),secureJsonData:w(v({},t.secureJsonData),{password:""})}))})),C(this,"onPasswordChange",(e=>{const{onOptionsChange:t,options:n}=this.props;t(w(v({},n),{secureJsonFields:w(v({},n.secureJsonFields),{password:!0}),secureJsonData:w(v({},n.secureJsonData),{password:e.target.value})}))}))}}const I=new e.DataSourcePlugin(u).setConfigEditor(O).setQueryEditor(b).setVariableQueryEditor((({onChange:e,query:t})=>{const[n,a]=(0,c.useState)(t);return p().createElement(p().Fragment,null,p().createElement("label",{className:"small"},"Specify a query that returns variable values and, optionally, their labels. Only strings are allowed here, so use CAST(column as text) if needed. First returned column interpreted as a value and second as a label. Labels should be used in cases when there is an intention to hide exact variable values behind human-readable names in the Grafana UI."),p().createElement("br",null),p().createElement(h.TextArea,{name:"query",className:"gf-form-input",onBlur:()=>{e(n,`${n.query}`)},onChange:e=>{return a((t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){f(e,t,n[t])}))}return e}({},n),r=null!=(r={[e.currentTarget.name]:e.currentTarget.value})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n.push.apply(n,a)}return n}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t));var t,r},value:n.query,placeholder:"SELECT sensor_id, location FROM sensors.sensors_locations"}))}))})(),i})()));
//# sourceMappingURL=module.js.map